components:
  parameters:
    pageOffset:
      name: page
      description: 分页页码
      in: query
      schema:
        type: integer
        default: 1
      required: false
    pageLimit:
      name: size
      description: 每页返回条数
      in: query
      schema:
        type: integer
        default: 10
      required: false
  schemas:
    CreateConversationRequest:
      type: object
      description: 创建会话请求体。
      properties:
        agent_id:
          type: string
          description: agent ID。
        agent_version:
          type: string
          description: agent 版本，“latest“表示最新版本
        executor_version:
          type: string
          description: 智能体执行引擎版本，最新为“v2“
      required:
        - agent_id
        - agent_version

    ChatCompletionRequest:
      type: object
      description: 对话请求体。
      properties:
        agent_id:
          type: string
          description: agent ID。
        agent_version:
          type: string
          description: agent 版本，“latest“表示最新版本
          enum: [latest]
        executor_version:
          type: string
          description: 智能体执行引擎版本，最新为“v2“
          enum: [v2]
        conversation_id:
          type: string
          description: 会话 ID。
        custom_querys:
          type: object
          description: 传给智能体的额外参数
        query:
          type: string
          description: 用户输入的问题。
        stream:
          type: boolean
          description: 是否流式返回。
      required:
        - query
        - agent_id
        - agent_version
        - executor_version
        - conversation_id
        - stream

    EventMessage:
      type: object
      description: Event Stream 消息，用于流式更新消息树上的节点
      properties:
        seq_id:
          type: integer
          description: Event Message 序号
        key:
          type: array
          items:
            oneOf:
              - type: string
              - type: integer
          description: 要操作的对象的属性路径。数字表示数组下标，字符串表示对象属性名。例如 ["message","ext","related_queries"] 表示 message.ext.related_queries
        action:
          type: string
          enum: [append, upsert]
          description: |
            对象属性的操作类型：
              - append：向数组追加元素或在文本后追加内容
              - upsert：插入对象属性
        content:
          oneOf:
            - type: string
            - type: integer
            - $ref: "#/components/schemas/RelatedQueriesContent"
            - $ref: "#/components/schemas/Message"
            - $ref: "#/components/schemas/Progress"
            - $ref: "#/components/schemas/LLMAnswer"
            - $ref: "#/components/schemas/ToolAnswer"
          description: 表示要 upsert 或 append 的内容
      required:
        - seq_id
        - key
        - action
        - content

    # 当 key 为 ["message","ext","related_queries"] 且 action 为 "upsert" 时，content 为该格式
    RelatedQueriesContent:
      type: array
      description: 相关推荐问题列表，用于 message.ext.related_queries 的 upsert
      items:
        type: string
      example: ["过去两年销量增长最快的消费品牌是哪家？", "品牌销量的具体同比增长率是多少？", "相比今年，去年有哪些品牌销量下降？"]
    
    Message:
      index:
        type: int
        description: 消息下标，用于前端消息排序
      id:
        type: string
        description: 消息 ID
      conversation_id:
        type: string
        description: 会话 ID
      role:
        type: string
        enum: [user, assistant]
      content:
        type: object
        properties: 
          final_answer:
            $ref: "#/components/schemas/FinalAnswer"
          middle_answer:
            $ref: "#/components/schemas/MiddleAnswer"
  
    FinalAnswer:
      type: object
      description: 智能体最终的输出
      properties:
        thinking:
          type: string
        answer:
          type: object
          properties:
            text:
              type: string
              description: 智能体最终输出的文本内容
        answer_type_other:
          $ref: "#/components/schemas/OtherTypeAnswer"
      
    MiddleAnswer:
      type: object
      description: 智能体执行过程中的输出
      properties:
        progress:
          type: array
          items:
            $ref: "#/components/schemas/Progress"
    
    OtherTypeAnswer:
      type: object
      description: 智能体输出的非文本类型内容
      properties:
        stage:
          type: string
          description: |
            输出的类型：
              - llm：表示大模型输出
              - skill：表示技能调用
              - assign: 变量赋值
          enum: [llm, skill, assign]
        answer:
          oneOf:
            - $ref: '#/components/schemas/ExecuteCodeResult'
            - $ref: '#/components/schemas/AfSailorResult'
            - $ref: '#/components/schemas/DatasourceFilterResult'
            - $ref: '#/components/schemas/KnSearchResult'
        skill_info:
          $ref: "#/components/schemas/SkillInfo"
        interrupted:
          type: boolean
          description: 是否中断
        flags:
          type: string
          description: 标志位
        end_time:
          type: number
          format: float
          description: 结束时间戳
        estimated_output_tokens:
          type: integer
          description: 预估输出 tokens 数
        status:
          type: string
          description: 步骤的执行状态
          enum: [processing, completed]
        input_message:
          type: string
          description: 输入消息
        id:
          type: string
          description: 步骤 ID
        token_usage:
          $ref: "#/components/schemas/TokenUsage"
        think:
          type: string
          description: 执行步骤中的思考过程
        agent_name:
          type: string
          description: 智能体名称
        block_answer:
          oneOf:
            - $ref: "#/components/schemas/AfSailorBlockAnswer"
            - $ref: "#/components/schemas/DatasourceFilterBlockAnswer"
        estimated_input_tokens:
          type: integer
          description: 预估输入 tokens 数
        start_time:
          type: number
          format: float
          description: 开始时间戳
        estimated_ratio_tokens:
          type: integer
          description: 预估比例 tokens 数
    
    Progress:
      type: object
      description: 智能体执行过程中的一个步骤
      properties:
        stage:
          type: string
          description: |
            步骤的类型：
              - llm：表示大模型输出
              - skill：表示技能调用
              - assign: 变量赋值
          enum: [llm, skill, assign]
        answer:
          oneOf:
          - $ref: "#/components/schemas/LLMAnswer"
          - $ref: "#/components/schemas/ToolAnswer"
          - $ref: "#/components/schemas/Text2SqlResult"
          - $ref: "#/components/schemas/Text2MetricResult"
          - $ref: "#/components/schemas/AfSailorResult"
          - $ref: "#/components/schemas/DatasourceFilterResult"
          - $ref: "#/components/schemas/KnSearchResult"
        think:
          type: string
          description: 执行步骤中的思考过程
        status:
          type: string
          description: 步骤的执行状态
          enum: [processing, completed]
        skill_info:
          $ref: "#/components/schemas/SkillInfo"
        input_message:
          type: string
          description: 输入消息
        estimated_output_tokens:
          type: integer
          description: 预估输出 tokens 数
        id:
          type: string
          description: 步骤 ID
        agent_name:
          type: string
          description: 智能体名称
        start_time:
          type: number
          format: float
          description: 开始时间戳
        end_time:
          type: number
          format: float
          description: 结束时间戳
        estimated_input_tokens:
          type: integer
          description: 预估输入 tokens 数
        estimated_ratio_tokens:
          type: integer
          description: 预估比例 tokens 数
        token_usage:
          $ref: "#/components/schemas/TokenUsage"
        interrupted:
          type: boolean
          description: 是否中断
        flags:
          type: string
          description: 标志位
  
    LLMAnswer:
      type: string
      description: 当 stage 为 “llm” 时表示大模型输出的文本
      
    ToolAnswer:
      type: object
      description: 当 stage 为 "skill" 时表示调用技能的输入输出
      properties:
        choices:
          type: array
          description: 调用工具。返回多个表示调用了多次工具
          items:
          type: object
          properties:
            message:
              type: object
              description: 技能消息
              properties:
                role:
                  type: string
                  enum: [tool]
                tool_calls:
                  type: array
                  description: 单次工具调用的输入输出
                  prefixItems:
                  - oneOf:
                    - $ref: "#/components/schemas/ToolCall"
                  items:
                    oneOf:
                    - $ref: "#/components/schemas/ToolResult"
    
    ToolCall:
      type: object
      description: 调用工具的输入
      oneOf:
      - "#/components/schemas/SearchIntent"
      - $ref: "#/components/schemas/Text2SqlIntent"
      - $ref: "#/components/schemas/Text2MetricIntent"
    
    ToolResult:
      type: object
      description: 调用工具的输出结果
      oneOf:
      - "#/components/schemas/SearchResult"
      - $ref: "#/components/schemas/Text2SqlResult"
      - $ref: "#/components/schemas/Text2MetricResult"
      - $ref: "#/components/schemas/AfSailorResult"
      - $ref: "#/components/schemas/DatasourceFilterResult"
      - $ref: "#/components/schemas/KnSearchResult"
    
    TokenUsage:
      type: object
      description: Token使用情况
      properties:
        prompt_tokens:
          type: integer
          description: 提示tokens数
        completion_tokens:
          type: integer
          description: 完成tokens数
        total_tokens:
          type: integer
          description: 总tokens数
        prompt_tokens_details:
          type: object
          description: 提示tokens详情
          properties:
            cached_tokens:
              type: integer
              description: 缓存的tokens数
            uncached_tokens:
              type: integer
              description: 未缓存的tokens数
    
    Json2PlotAnswer:
      type: object
      description: json2plot工具的返回结果
      properties:
        result:
          $ref: "#/components/schemas/Json2PlotResult"
        full_result:
          $ref: "#/components/schemas/Json2PlotFullResult"
    
    Json2PlotResult:
      type: object
      description: json2plot工具的结果数据
      properties:
        data_sample:
          type: array
          description: 数据样本
          items:
            type: object
            additionalProperties: true
        chart_config:
          $ref: "#/components/schemas/ChartConfig"
        title:
          type: string
          description: 图表标题
        text:
          type: string
          description: 图表说明文本
        result_cache_key:
          type: string
          description: 结果缓存key
    
    Json2PlotFullResult:
      type: object
      description: json2plot工具的完整结果数据
      properties:
        chart_config:
          $ref: "#/components/schemas/ChartConfig"
        title:
          type: string
          description: 图表标题
        text:
          type: string
          description: 图表说明文本
        result_cache_key:
          type: string
          description: 结果缓存key
        data:
          type: array
          description: 完整数据
          items:
            type: object
            additionalProperties: true
    
    ChartConfig:
      type: object
      description: 图表配置
      properties:
        xField:
          type: string
          description: X轴字段
        yField:
          type: string
          description: Y轴字段
        seriesField:
          type: string
          description: 系列字段
        chart_type:
          type: string
          description: 图表类型
          enum: [Column, Line, Pie, Circle]
        groupField:
          type: string
          description: 分组字段
        isStack:
          type: boolean
          description: 是否堆叠
        isGroup:
          type: boolean
          description: 是否分组
    
    SearchIntent:
      type: object
      description: 智谱搜索工具的输入查询
      properties:
        type:
          type: string
          enum: [search_intent]
        search_intent:
          type: array
          items:
            type: object
            description: 搜索参数
            properties:
              keywords:
                type: string
              query:
                type: string
              intent:
                type: string
                enum: [SEARCH_ALL]
    
    SearchResult:
      type: object
      description: 智谱搜索工具的返回结果
      properties:
        type: 
          type: string
          enum: [search_result]
        search_result:
          type: array
          items:
            type: object
            properties:
              icon:
                type: string
                description: 搜索结果的来源网站图标 URL
              link:
                type: string
                description: 搜索结果的来源地址
              media:
                type: string
                description: 搜索结果的来源网站名称
              title:
                type: string
                description: 搜索结果的来源文章标题
              content:
                type: string
                description: 搜索结果的内容摘要
    
    ExecuteCodeResult:
      type: object
      description: 代码执行工具的返回结果
      properties:
        result:
          type: object
          properties:
            title:
              type: string
              description: 代码执行结果标题
            action:
              type: string
              description: 工具名称
              enum: [execute_code]
            result:
              type: object
              description: 工具执行结果
              properties:
                stdout:
                  type: string
                  description: 代码执行后转为自然语言的输出结果
    
    Text2SqlIntent:
      type: object
      description: text2sql工具的输入查询
      properties:
        action:
          type: string
          description: 操作类型
          enum: [gen_exec]
        input:
          type: string
          description: 输入查询文本
    
    Text2SqlResult:
      type: object
      description: text2sql工具的返回结果
      properties:
        result:
          $ref: "#/components/schemas/Text2SqlResultData"
        full_result:
          $ref: "#/components/schemas/Text2SqlFullResultData"
    
    Text2SqlResultData:
      type: object
      description: text2sql工具的结果数据
      properties:
        cites:
          type: array
          description: 数据源引用列表
          items:
            $ref: "#/components/schemas/DataCite"
        result_cache_key:
          type: string
          description: 结果缓存key
        data_desc:
          type: object
          description: 数据描述信息
          properties:
            return_records_num:
              type: integer
              description: 返回记录数
            real_records_num:
              type: integer
              description: 实际记录数
        data:
          type: array
          description: 数据样本
          items:
            type: object
            additionalProperties: true
        sql:
          type: string
          description: 执行的SQL语句
        explanation:
          type: object
          description: 解释信息
          additionalProperties:
            type: array
            items:
              type: object
              additionalProperties: true
        title:
          type: string
          description: 结果标题
        message:
          type: string
          description: 结果消息
    
    Text2SqlFullResultData:
      type: object
      description: text2sql工具的完整结果数据
      properties:
        data:
          type: array
          description: 完整数据
          items:
            type: object
            additionalProperties: true
        result_cache_key:
          type: string
          description: 结果缓存key
        sql:
          type: string
          description: 执行的SQL语句
        explanation:
          type: object
          description: 解释信息
          additionalProperties:
            type: array
            items:
              type: object
              additionalProperties: true
        title:
          type: string
          description: 结果标题
        message:
          type: string
          description: 结果消息
        cites:
          type: array
          description: 数据源引用列表
          items:
            $ref: "#/components/schemas/DataCite"
    
    DataCite:
      type: object
      description: 数据源引用信息
      properties:
        id:
          type: string
          description: 数据源ID
        name:
          type: string
          description: 数据源名称
        type:
          type: string
          description: 数据源类型
          enum: [data_view]
        description:
          type: string
          description: 数据源描述

    Text2MetricIntent:
      type: object
      description: text2metric工具的输入查询
      properties:
        input:
          type: string
          description: 输入查询文本

    Text2MetricResult:
      type: object
      description: text2metric工具的返回结果
      properties:
        result:
          $ref: "#/components/schemas/Text2MetricResultData"
        full_result:
          $ref: "#/components/schemas/Text2MetricFullResultData"

    Text2MetricResultData:
      type: object
      description: text2metric工具的结果数据
      properties:
        title:
          type: string
          description: 结果标题
        data_desc:
          $ref: "#/components/schemas/MetricDataDesc"
        explanation:
          type: string
          description: 解释说明
        reason:
          type: string
          description: 查询原因
        query_params:
          $ref: "#/components/schemas/MetricQueryParams"
        step:
          type: string
          description: 时间聚合方式
        unit:
          type: string
          description: 单位
        unit_type:
          type: string
          description: 单位类型
        data_summary:
          $ref: "#/components/schemas/MetricDataSummary"
        metric_id:
          type: string
          description: 指标ID
        result_cache_key:
          type: string
          description: 结果缓存key
        cites:
          type: array
          description: 指标引用列表
          items:
            $ref: "#/components/schemas/MetricCite"
        data:
          type: array
          description: 数据样本
          items:
            type: object
            additionalProperties: true

    Text2MetricFullResultData:
      type: object
      description: text2metric工具的完整结果数据
      properties:
        data:
          type: array
          description: 完整数据
          items:
            type: object
            additionalProperties: true
        metric_id:
          type: string
          description: 指标ID
        explanation:
          type: string
          description: 解释说明
        step:
          type: string
          description: 时间聚合方式
        unit:
          type: string
          description: 单位
        unit_type:
          type: string
          description: 单位类型
        result_cache_key:
          type: string
          description: 结果缓存key
        data_summary:
          $ref: "#/components/schemas/MetricDataSummary"
        cites:
          type: array
          description: 指标引用列表
          items:
            $ref: "#/components/schemas/MetricCite"
        reason:
          type: string
          description: 查询原因
        title:
          type: string
          description: 结果标题
        query_params:
          $ref: "#/components/schemas/MetricQueryParams"

    MetricDataDesc:
      type: object
      description: 指标数据描述信息
      properties:
        return_records_num:
          type: integer
          description: 返回记录数
        real_records_num:
          type: integer
          description: 实际记录数

    MetricDataSummary:
      type: object
      description: 指标数据摘要信息
      properties:
        unit:
          type: string
          description: 单位
        unit_type:
          type: string
          description: 单位类型
        total_data_points:
          type: integer
          description: 总数据点数
        force_limit:
          type: integer
          description: 强制限制数
        step:
          type: string
          description: 时间聚合方式

    MetricQueryParams:
      type: object
      description: 指标查询参数
      properties:
        instant:
          type: boolean
          description: 是否即时查询
        start:
          type: string
          description: 开始时间
        end:
          type: string
          description: 结束时间
        step:
          type: string
          description: 时间聚合方式
        analysis_dimensions:
          type: array
          description: 分析维度列表
          items:
            type: string

    MetricCite:
      type: object
      description: 指标引用信息
      properties:
        id:
          type: string
          description: 指标ID
        name:
          type: string
          description: 指标名称
        type:
          type: string
          description: 指标类型
          enum: [metric]

    SkillInfo:
      type: object
      desciption: 调用技能的技能详情
      properties:
        type:
          type: string
          description: |
            技能类型：
            - TOOL：工具
            - MCP：MCP 协议
            - AGENT：调用其他智能体
          enum: [TOOL, MCP, AGENT]
        name:
          type: string
          desciption: 技能名称
        args:
          type: array
          desciption: 技能参数
          items:
            type: object
            properties:
              name:
                type: string
                desciption: 参数名
              type:
                type: string
                desciption: 参数类型
                enum: [str]
              value:
                desciption: 参数值
                type: string
        checked:
          type: boolean
          description: 是否已检查

    AfSailorResult:
      type: object
      description: af_sailor工具的返回结果
      properties:
        result:
          $ref: "#/components/schemas/AfSailorResultData"

    AfSailorResultData:
      type: object
      description: af_sailor工具的结果数据
      properties:
        text:
          type: array
          description: 文本内容数组
          items:
            type: string
        cites:
          type: array
          description: 数据目录引用列表
          items:
            $ref: "#/components/schemas/DataCatalogCite"
        result_cache_key:
          type: string
          description: 结果缓存key

    AfSailorBlockAnswer:
      type: object
      description: af_sailor工具的block_answer数据
      properties:
        result:
          $ref: "#/components/schemas/AfSailorResultData"

    DataCatalogCite:
      type: object
      description: 数据目录引用信息
      properties:
        type:
          type: string
          description: 引用类型
          enum: [data_catalog]
        title:
          type: string
          description: 数据目录标题
        description:
          type: string
          description: 数据目录描述
        id:
          type: integer
          description: 数据目录ID
        code:
          type: string
          description: 数据目录代码

    DatasourceFilterResult:
      type: object
      description: datasource_filter工具的返回结果
      properties:
        result:
          $ref: "#/components/schemas/DatasourceFilterResultData"

    DatasourceFilterResultData:
      type: object
      description: datasource_filter工具的结果数据
      properties:
        result:
          type: array
          description: 数据目录匹配结果列表
          items:
            $ref: "#/components/schemas/DataCatalogMatch"
        result_cache_key:
          type: string
          description: 结果缓存key

    KnSearchResult:
      type: object
      description: kn_search工具的返回结果
      properties:
        result:
          $ref: "#/components/schemas/KnSearchResultData"

    KnSearchResultData:
      type: object
      description: kn_search工具的结果数据
      properties:
        object_types:
          type: array
          description: 知识网络中的对象类型列表
          items:
            $ref: "#/components/schemas/ObjectType"
        relation_types:
          type: array
          description: 对象类型之间的关系类型列表
          items:
            $ref: "#/components/schemas/KnowledgeRelationType"
        action_types:
          type: array
          description: 动作类型列表（预留字段）
          items:
            type: string
        nodes:
          type: array
          description: 匹配到的知识网络节点列表
          items:
            $ref: "#/components/schemas/KnowledgeNode"

    KnowledgeRelationType:
      type: object
      description: 知识网络关系类型
      properties:
        concept_id:
          type: string
          description: 关系概念 ID
        concept_name:
          type: string
          description: 关系概念名称
        source_object_type_id:
          type: string
          description: 源对象类型 ID
        target_object_type_id:
          type: string
          description: 目标对象类型 ID

    KnowledgeNode:
      type: object
      description: 知识网络中的节点
      properties:
        object_type_id:
          type: string
          description: 节点所属的对象类型 ID
        unique_identities:
          type: object
          description: 唯一标识字段集合
          additionalProperties: true
        data_properties:
          type: object
          description: 节点的数据属性集合
          additionalProperties: true
        final_score:
          type: number
          format: float
          description: 节点匹配得分

    DatasourceFilterBlockAnswer:
      type: object
      description: datasource_filter工具的block_answer数据
      properties:
        result:
          $ref: "#/components/schemas/DatasourceFilterResultData"

    DataCatalogMatch:
      type: object
      description: 数据目录匹配结果
      properties:
        type:
          type: string
          description: 引用类型
          enum: [data_catalog]
        title:
          type: string
          description: 数据目录标题
        id:
          type: string
          description: 数据目录ID
        reason:
          type: string
          description: 匹配原因
        matched_columns:
          type: array
          description: 匹配的列信息
          items:
            type: object
            description: 匹配的列，键为字段技术名称，值为字段值
            additionalProperties:
              type: string
      
    ConversationListResponse:
      type: object
      summary: 历史会话列表
      properties:
        total_count:
          type: integer
          description: 结果总数
        entries:
          type: array
          description: 会话列表
          items:
            $ref: '#/ConversationItem'

    ConversationItem:
      description: 单条历史会话
      type: object
      properties:
        id:
          type: string
          description: 会话 ID
        title:
          type: string
          description: 会话标题
        message_index:
          type: integer
          description: 最新会话消息下标
        read_message_index:
          type: integer
          description: 最新已读的会话消息下标
        create_time:
          type: integer
          description: 创建时间
        update_time:
          type: integer
          description: 更新时间
      required:
        - id
        - title

    ConversationDetail:
      description: 会话详情
      type: object
      properties:
        id:
          type: string
          description: 会话ID
        title:
          type: string
          description: 会话标题
        Messages:
          type: array
          description: 会话消息列表
          items:
            $ref: '#/ConversationMessage'
        create_time:
          type: integer
          description: 创建时间
        update_time:
          type: integer
          description: 更新时间
      required:
        - id
        - title

    ConversationMessage:
      description: 会话消息
      type: object
      properties:
        id:
          type: string
          description: 消息 ID
        conversation_id:
          type: string
          description: 会话 ID
        index:
          type: integer
          description: 消息下标
          example: 0
        origin:
          type: string
          enum: [user, assistant]
          description: |
            消息发送角色:
              - user：用户
              - assistant：助手
        content(when origin=user):
          type: string
          description: 用户消息内容
          properties:
            text:
              type: string
              description: 文本内容
        content(when origin=assistant):
          type: string
          description: |
            AI 助手消息内容，经过 JSON 反序列化之后，会得到和 #/components/schemas/Message/content 相同的结构
        create_time:
          type: integer
          description: 消息创建时间
        update_time:
          type: integer
          description: 消息更新时间
      required:
        - id
        - conversation_id
        - index
        - origin

    KnowledgeNetworkDetail:
      type: object
      description: 知识网络详情
      properties:
        id:
          type: string
          description: 知识网络 ID
        name:
          type: string
          description: 知识网络名称
        tags:
          type: array
          description: 标签列表
          items:
            type: string
        comment:
          type: string
          description: 备注
        icon:
          type: string
          description: 图标
        color:
          type: string
          description: 颜色
        detail:
          type: string
          description: 详情信息（JSON 字符串）
        branch:
          type: string
          description: 分支
        business_domain:
          type: string
          description: 业务域
        creator:
          $ref: "#/components/schemas/UserInfo"
        create_time:
          type: integer
          description: 创建时间
        updater:
          $ref: "#/components/schemas/UserInfo"
        update_time:
          type: integer
          description: 更新时间
        module_type:
          type: string
          description: 模块类型
          enum: [knowledge_network]
        operations:
          type: array
          description: 操作权限列表
          items:
            type: string
            enum: [modify, task_manage, view_detail, create, delete, data_query, authorize, import, export]

    UserInfo:
      type: object
      description: 用户信息
      properties:
        id:
          type: string
          description: 用户 ID
        type:
          type: string
          description: 用户类型
          enum: [user]
        name:
          type: string
          description: 用户名称

    ObjectTypeListResponse:
      type: object
      description: 对象类型列表响应
      properties:
        entries:
          type: array
          description: 对象类型列表
          items:
            $ref: "#/components/schemas/ObjectType"
        total_count:
          type: integer
          description: 总数

    ObjectType:
      type: object
      description: 对象类型
      properties:
        id:
          type: string
          description: 对象类型 ID
        name:
          type: string
          description: 对象类型名称
        data_source:
          $ref: "#/components/schemas/DataSource"
        data_properties:
          type: array
          description: 数据属性列表
          items:
            $ref: "#/components/schemas/DataProperty"
        primary_keys:
          type: array
          description: 主键列表
          items:
            type: string
        display_key:
          type: string
          description: 显示键
        incremental_key:
          type: string
          description: 增量键
        tags:
          type: array
          description: 标签列表
          items:
            type: string
        comment:
          type: string
          description: 备注
        icon:
          type: string
          description: 图标
        color:
          type: string
          description: 颜色
        detail:
          type: string
          description: 详情
        kn_id:
          type: string
          description: 知识网络 ID
        branch:
          type: string
          description: 分支
        status:
          $ref: "#/components/schemas/ObjectTypeStatus"
        creator:
          $ref: "#/components/schemas/UserInfo"
        create_time:
          type: integer
          description: 创建时间
        updater:
          $ref: "#/components/schemas/UserInfo"
        update_time:
          type: integer
          description: 更新时间
        module_type:
          type: string
          description: 模块类型
          enum: [object_type]

    DataSource:
      type: object
      description: 数据源
      properties:
        type:
          type: string
          description: 数据源类型
          enum: [data_view]
        id:
          type: string
          description: 数据源 ID
        name:
          type: string
          description: 数据源名称

    DataProperty:
      type: object
      description: 数据属性
      properties:
        name:
          type: string
          description: 属性名称
        display_name:
          type: string
          description: 显示名称
        type:
          type: string
          description: 属性类型
          enum: [string, integer, float, datetime]
        comment:
          type: string
          description: 备注
        mapped_field:
          $ref: "#/components/schemas/MappedField"
        condition_operations:
          type: array
          description: 条件操作列表
          items:
            type: string
            enum: [==, !=, like, not_like, in, not_in]

    MappedField:
      type: object
      description: 映射字段
      properties:
        name:
          type: string
          description: 字段名称
        type:
          type: string
          description: 字段类型
        display_name:
          type: string
          description: 显示名称

    ObjectTypeStatus:
      type: object
      description: 对象类型状态
      properties:
        incremental_key:
          type: string
          description: 增量键
        incremental_value:
          type: string
          description: 增量值
        index:
          type: string
          description: 索引
        index_available:
          type: boolean
          description: 索引是否可用
        doc_count:
          type: integer
          description: 文档数量
        storage_size:
          type: integer
          description: 存储大小
        update_time:
          type: integer
          description: 更新时间

    MetricModel:
      type: object
      description: 指标模型
      properties:
        id:
          type: string
          description: 指标 ID
        name:
          type: string
          description: 指标名称
        catalog_id:
          type: string
          description: 目录 ID
        catalog_content:
          type: string
          description: 目录内容
        measure_name:
          type: string
          description: 度量名称
        group_id:
          type: string
          description: 分组 ID
        group_name:
          type: string
          description: 分组名称
        tags:
          type: array
          description: 标签列表
          items:
            type: string
        comment:
          type: string
          description: 备注
        metric_type:
          type: string
          description: 指标类型
          enum: [atomic, composite]
        data_view_id:
          type: string
          description: 数据视图 ID
        query_type:
          type: string
          description: 查询类型
          enum: [sql]
        formula:
          type: string
          description: 公式
        formula_config:
          $ref: "#/components/schemas/FormulaConfig"
        analysis_dimensions:
          type: array
          description: 分析维度列表
          items:
            $ref: "#/components/schemas/AnalysisDimension"
        date_field:
          type: string
          description: 日期字段
        measure_field:
          type: string
          description: 度量字段
        unit_type:
          type: string
          description: 单位类型
          enum: [currencyUnit, percentageUnit]
        unit:
          type: string
          description: 单位
        builtin:
          type: boolean
          description: 是否内置
        is_calendar_interval:
          type: integer
          description: 是否日历间隔
        creator:
          $ref: "#/components/schemas/UserInfo"
        create_time:
          type: integer
          description: 创建时间
        update_time:
          type: integer
          description: 更新时间
        operations:
          type: array
          description: 操作权限列表
          items:
            type: string
            enum: [modify, delete, data_query, authorize, view_detail, import, export, create]
        data_source:
          $ref: "#/components/schemas/MetricDataSource"
        data_view_name:
          type: string
          description: 数据视图名称
        fields_map:
          type: object
          description: 字段映射
          additionalProperties:
            $ref: "#/components/schemas/FieldMap"
        module_type:
          type: string
          description: 模块类型
          enum: [metric_model]

    FormulaConfig:
      type: object
      description: 公式配置
      properties:
        aggr_expression:
          $ref: "#/components/schemas/AggrExpression"

    AggrExpression:
      type: object
      description: 聚合表达式
      properties:
        field:
          type: string
          description: 字段名
        aggr:
          type: string
          description: 聚合函数
          enum: [sum, avg, count, max, min]

    AnalysisDimension:
      type: object
      description: 分析维度
      properties:
        name:
          type: string
          description: 维度名称
        type:
          type: string
          description: 维度类型
          enum: [string, integer, float, datetime]
        display_name:
          type: string
          description: 显示名称
        comment:
          type: string
          description: 备注

    MetricDataSource:
      type: object
      description: 指标数据源
      properties:
        type:
          type: string
          description: 数据源类型
          enum: [SQL]
        id:
          type: string
          description: 数据源 ID
        name:
          type: string
          description: 数据源名称

    FieldMap:
      type: object
      description: 字段映射
      properties:
        name:
          type: string
          description: 字段名称
        type:
          type: string
          description: 字段类型
        display_name:
          type: string
          description: 显示名称
        comment:
          type: string
          description: 备注